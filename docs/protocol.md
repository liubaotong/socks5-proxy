# SOCKS5 协议说明

## 协议流程

1. 客户端认证
   - 客户端发送版本和认证方法
   - 服务器响应选择的认证方法

2. 请求阶段
   - 客户端发送请求详情（目标地址和端口）
   - 服务器尝试连接目标并响应结果

3. 数据转发
   - 建立连接后双向转发数据

## 数据格式

### 认证请求
```
+----+----------+----------+
|VER | NMETHODS | METHODS  |
+----+----------+----------+
| 1  |    1     | 1 to 255 |
+----+----------+----------+
```

### 认证响应
```
+----+--------+
|VER | METHOD |
+----+--------+
| 1  |   1    |
+----+--------+
```

### 连接请求
```
+----+-----+-------+------+----------+----------+
|VER | CMD |  RSV  | ATYP | DST.ADDR | DST.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X'00' |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+
```

### 连接响应
```
+----+-----+-------+------+----------+----------+
|VER | REP |  RSV  | ATYP | BND.ADDR | BND.PORT |
+----+-----+-------+------+----------+----------+
| 1  |  1  | X'00' |  1   | Variable |    2     |
+----+-----+-------+------+----------+----------+
```

## 错误处理

- 0x00: 成功
- 0x01: 服务器故障
- 0x02: 规则不允许连接
- 0x03: 网络不可达
- 0x04: 主机不可达
- 0x05: 连接被拒绝
- 0x06: TTL 过期
- 0x07: 不支持的命令
- 0x08: 不支持的地址类型 